<!DOCTYPE html>
<html lang="en">

<head>
    <title>Air Force Innovation</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>

    <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous"/>
</head>

<header>
    <nav class="navbar navbar-light" style="background-color:#0d47a1;">
        <a class="navbar-brand text-white" href="https://www.afwerx.af.mil/" >
        <img src="img/afwerx-logo.jpg"
            width="50" height="50" class="d-inline-block align-center" alt="">
            Air Force Innovation with AFWERX </a>
    </nav>
</header>

<body class="body">

    <iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=19P07PeeYrIg7972c5hoIaMgPXwCNrbvxFoDaL39Qla4&font=Default&lang=en&initial_zoom=2&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe>

    <h2>How does the Applicant Pool Vary by Period and Channel?</h2>
    <div id="histogram_cost"></div>
    <h3>Application Period</h3>
    <div class="row align-items-center">
        <div class="col-sm-2"><p id="value-time"></p></div>
        <div class="col-sm"><div id="slider-time"></div></div>
    </div>

    <script src="js/timeline.js"></script>
    <script type = "text/javascript">
    var dataset; //declare global varible, initially empty
    d3.csv("data.csv", function(d) {
        return {
            year: d.year,
            solicitation: d.solicitation,
            solicitation_date_gen: d.solicitation_date_gen,
            employees: parseFloat(d.employees),
            special: d.special,
            pitch: d.pitch,
            prev_award: d.prev_award,
            phase: d.phase,
            select: d.select,
            financing_status: d.financing_status,
            cost: parseFloat(d.cost)
            };
        }).then(function(data) {
            dataset = data;
        });
    //set dims of graph
    var margin = {top: 10, right: 30, bottom: 30, left: 40},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;
    //append svg object to the body of the page
    var svg = d3.select("#histogram_cost")
        .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
        .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
    // X axis: scale and draw:
    var x = d3.scaleLinear()
        .domain([0, d3.max(dataset, function(d) { return d.cost })])     // can use this instead of 1000 to have the max of data: d3.max(data, function(d) { return +d.price })
        .range([0, width]);
    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));
    // set the parameters for the histogram
    var histogram = d3.histogram()
        .value(function(d) { return d.cost; })   // I need to give the vector of value
        .domain(x.domain())  // then the domain of the graphic
        .thresholds(x.ticks(70)); // then the numbers of bins

    // And apply this function to data to get the bins
    var bins = histogram(dataset);

    // Y axis: scale and draw:
    var y = d3.scaleLinear()
        .range([height, 0]);
        y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
    svg.append("g")
        .call(d3.axisLeft(y));

    // append the bar rectangles to the svg element
    svg.selectAll("rect")
        .data(bins)
        .enter()
        .append("rect")
           .attr("x", 1)
           .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
           .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
           .attr("height", function(d) { return height - y(d.length); })
           .style("fill", "#69b3a2")

    </script>

</body>
</html>
